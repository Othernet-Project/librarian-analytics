// Generated by CoffeeScript 1.10.0
(function(window, $) {
  var FOLDER_ROOT, LOCALE, TRACK_PATH, TZ_OFFSET, URL_ROOT, decode, getTrackingUrl, recordEvent, stripRoot;
  TRACK_PATH = 'analytics';
  LOCALE = (window.location.pathname.split('/'))[1];
  TZ_OFFSET = -(new Date()).getTimezoneOffset() / 60.0;
  URL_ROOT = "/direct";
  FOLDER_ROOT = "/" + LOCALE + "/files";
  getTrackingUrl = function() {
    return "/" + LOCALE + "/" + TRACK_PATH + "/";
  };
  decode = function(data) {
    while (decodeURIComponent(data) !== data) {
      data = decodeURIComponent(data);
    }
    return data;
  };
  stripRoot = function(data) {
    return data.replace(URL_ROOT, "").replace(FOLDER_ROOT, "");
  };
  recordEvent = function(e, data) {
    var ref, res;
    data.path = stripRoot(decode(data.path));
    data.tz = TZ_OFFSET;
    console.log(data);
    res = $.ajax({
      url: getTrackingUrl(),
      type: 'POST',
      data: data,
      async: !((ref = data.type) === 'file' || ref === 'download')
    });
  };
  ($(window)).on('analytics-collect', recordEvent);
})(this, this.jQuery);
